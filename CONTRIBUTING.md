# Contributing to Kalle

This document aims to ease new contributors into working on Kalle.

<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=3 orderedList=false} -->

<!-- code_chunk_output -->

- [Introduction to the Codebase](#introduction-to-the-codebase)
  - [Term Definitions](#term-definitions)
  - [Starting a Development Environment](#starting-a-development-environment)
  - [Database Structure](#database-structure)
  - [Folder Structure](#folder-structure)
- [Some Code Guidelines](#some-code-guidelines)

<!-- /code_chunk_output -->

## Introduction to the Codebase

This introduction assumes that you've used Kalle and are familiar with the problem it solves.

### Term Definitions

To prevent misunderstanding, we agree on using the following terms to describe our problem domain:

| Term                   | Description                                                                                                                                                                                                        |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Appointment            | When the _Invitee_ selects a _Time Slot_ and triggers that the _Appointment_ is written to the _Calendar Owners_ calendar.                                                                                                                                             |
| Calendar Owner         | Registered user that uses Kalle to invite people (aka to use Kalle to send a link to get _Appointment Suggestions_ from _Invitees_)                                                                                |
| Connected Calendar     | An external calendar, connected via CalDav / GCal / O365 / ...                                                                                                                                                     |
| Meeting                | Created by a _Calendar Owner_ when they want to schedule an appointment with someone. Can be understood as "the desire to speak about some topic". Kalle is used to help to find an _Appointment_ for a _Meeting_. |
| Integrated Calendar    | The Kalle-hosted calendar used for blocking slots                                                                                                                                                                  |
| Invite Link                | Generated by Kalle for a specific _Meeting_. The _Invite Link_ is sent to _Invitee_ that can select a _Time Slot_ to create an _Appointment_                                                                                                                                              |
| Invitee                | Invited by the _Calendar Owner_ to schedule an appointment with them.                                                                                                                                              |
| Schedule        | Time windows set by the _Calendar Owner_ in wich an _Appointment_ can be booked. It is the general availability (e.g. workdays from 9am to 5pm as "working days schedule"                                                                                                                                                        |
| Target Calendar        | The _Connected Calendars_ where _Appointments_ are inserted.                                                                                                                                                       |
| Time Slot              | An time period (its duration, e.g. 30 min. is defined by the calendar owner) in which the calendar owner is available and that can be picked from an _invitee_ to create as _appointment suggestion_.              |

#### Example of finding an Appointment

Alice wants to meet with Bob to talk about Goldfishes. For this purpose, she creates a _Meeting_ in Kalle with the topic "Goldfish Update". She sends Bob the _Invite Link_ to this _Meeting_ (e.g. kalle.app/alice/goldfish-updates).

Bob opens the link and gets a lot of _Time Slots_ displayed in wich Alice is available. He chooses one of them. This creates an _Appointment_ for this _Meeting_.

Alice receives an e-mail: "Bob has chosen a meeting". It is also inserted into her _Target Calendar_.

### Starting a Development Environment

Requirements:

- [ ] Docker, Docker-Compose
- [ ] Node.js

`npm install` to fetch dependencies.
`npm start` to start the dev environment.
<kbd>CTRL+C</kbd> to stop.
`docker-compose down` to tear it down.

`npm run db:seed` seeds the database (optional, but recommended).

`npx prisma migrate dev --preview-feature` creates and applies a database migration, in case you changed your `schema.prisma`.

`npm test` executes unit & integration tests. The first run can take a while, it'll fetch some Docker images in the background.

`npm cypress:open` starts Cypress (e2e tests).

### Database Structure

We use [Prisma](https://prisma.io) as our database client.
Familiarise yourself with Kalle's database schema by reading [`db/schema.prisma`](./db/schema.prisma).
You can use [Prisma-ERD](https://prisma-erd.simonknott.de) to visualize it.

### Folder Structure

Familiarity with Blitz.js is assumed. [Blitz.js Tutorial](https://blitzjs.com/docs/tutorial)

Kalle's core can be found in [`app/`](./app).
A good way of getting to grips with the codebase is to start at the `pages/`-folders, and work your way from there.

[`db/`](./db) contains the database schema, migrations and a seed script.

[`test/`](./test) contains all kinds of utilities needed for our integration tests.

[`cypress/`](./cypress) contains end-to-end tests.

[`email/`](./email) contains email templates.

### Getting started as a Developer
Great that you wan't to help to improve Kalle! Now you already know how our project ist structured, but where to get started? This section will give you a brief overview on how to structure new features.

Let's assume you want to add a new Page that allows you to create groups of users. You will probably startoff by createing a new folder `groups` for this.

In general there then will be 5 main things you will be using:
- **Adding a Page**: To do so, create a `pages` subfolder. All files in here will automatically be pages that can be reached from the frontend by the name of the file. In our example you may be adding a file named `addGroup` which will then represent a route that can be reached from the frontend. This file should contain a functional component of the type `BlitzPage` [More info](https://blitzjs.com/docs/pages)
- **Creating a DB model**: In order for the groups to be represented you will need to add a model to your database. Therefore add a new model to the file `db/schema.prisma` that describes the new entity. [More info](https://blitzjs.com/docs/database-overview)
- **Getting DB entries**: To get data from the database you will use queries, which should be bundled in the `queries` subfolder. Queries and mutations are functions that will be executed in the backend, but can be imported and used from your frontend files in the `pages` subfolder. For example you could create a query that returns all existing groups. This function could then be imported into a `listGroups` file in the `pages` folder. When calling the function the query will be executed in the backend, but you will receive the result as a value from the function and could use it to render the returned groups in the frontend. This may be confusing in the beginning, so make sure, to dive deeper into this concept in the Blitz.js Documentation.
- **Creating DB entries**: Adding or updating entries to the database happens via mutations. You should create a `mutations` subfolder containing these mutations.
- **Creating helper functions**: If your code is getting cluttered or you need helper functions, such as a function to convert dates to a human readable format, which you use multiple times, make sure to create a `utils` directory in which you add these functions for easier reuse

You now know the basic concepts of how our code is structures, so have fun diving deeper into our project!

## Some Code Guidelines

- We follow the [Github Flow](https://guides.github.com/introduction/flow/).
- Make sure to name your branches semantically succinct. We like to use the prefixes `feature/`, `fix/` and `chore/`.

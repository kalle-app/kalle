# Migration `20201230195545-added-google-queries`

This migration has been generated by lukas.laskowski at 12/30/2020, 8:55:45 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "CalendarCredentials" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "ownerId" INTEGER NOT NULL,
    "status" TEXT NOT NULL,
    "type" TEXT NOT NULL,
    "credentials" JSONB NOT NULL,

    PRIMARY KEY ("id")
)

ALTER TABLE "CalendarCredentials" ADD FOREIGN KEY("ownerId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201226142038-added-location-to-meeting..20201230195545-added-google-queries
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -16,8 +16,9 @@
   id             Int       @default(autoincrement()) @id
   createdAt      DateTime  @default(now())
   updatedAt      DateTime  @updatedAt
   name           String
+  username       String    @unique
   email          String    @unique
   hashedPassword String?
   role           String    @default("user")
   sessions       Session[]
@@ -37,8 +38,18 @@
   publicData         String?
   privateData        String?
 }
+model CalendarCredentials {
+  id  Int @id @default(autoincrement())
+  name String
+  owner User @relation(fields: [ownerId], references: [id])
+  ownerId Int
+  status String
+  type String
+  credentials Json
+}
+
 model ConnectedCalendar {
   id  Int @id @default(autoincrement())
   name String
   caldavAddress String
@@ -53,24 +64,33 @@
 model Meeting {
   id  Int @id @default(autoincrement())
   name String
   link String
-  owner User @relation(fields: [ownerId], references: [id])
-  ownerId Int
+  owner User @relation(fields: [ownerName], references: [username])
+  ownerName String
   description String
   duration Int
   timezone Int
   startDate DateTime
   endDate DateTime
+  schedule Schedule @relation(fields: [scheduleId], references: [id])
+  scheduleId Int
   location String
-  schedule DailySchedule[]
 }
 model DailySchedule {
     id Int @id @default(autoincrement())
     day String
     startTime String
     endTime String
-    meeting Meeting @relation(fields: [meetingId], references: [id])
-    meetingId Int
+    schedule Schedule @relation(fields: [scheduleId], references: [id])
+    scheduleId Int
 }
+model Schedule {
+  id Int @id @default(autoincrement())
+  name String
+  dailySchedules DailySchedule[]
+  owner User @relation(fields: [ownerId], references: [id])
+  ownerId Int
+}
+  
```


